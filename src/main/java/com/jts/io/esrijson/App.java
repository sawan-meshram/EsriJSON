package com.jts.io.esrijson;

import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.io.ParseException;
import org.locationtech.jts.io.WKTReader;

/**
 * Test EsriJSON IO 
 *
 */
public class App 
{
    public static void main( String[] args ) throws ParseException
    {
//        testEsriWriter();
        
        testEsriReader();
    }
    private static void testEsriReader() throws ParseException {
		EsriJsonReader reader = new EsriJsonReader();
		
		//pass
//		String point = "{\"x\":-103.20762634277341,\"y\":35.04658137962862,\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(point);
		
		//pass
//		String multipoint = "{\"points\":[[-97.06138,32.837],[-97.06133,32.836],[-97.06124,32.834],[-97.06127,32.832]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(multipoint);

		//pass
//		String multilinestring = "{\"paths\":[[[-97.06138,32.837],[-97.06133,32.836],[-97.06124,32.834],[-97.06127,32.832]],[[-97.06326,32.759],[-97.06298,32.755]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(multilinestring);

		//pass
//		String linestring = "{\"paths\":[[[-97.06138,32.837],[-97.06133,32.836],[-97.06124,32.834],[-97.06127,32.832]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(linestring);
		
		//failed, it shld be Multipolygon
		String polygon = "{\"rings\":[[[-97.06138,32.837],[-97.06133,32.836],[-97.06124,32.834],[-97.06127,32.832],[-97.06138,32.837]],[[-97.06326,32.759],[-97.06298,32.755],[-97.06153,32.749],[-97.06326,32.759]]],\"spatialReference\":{\"wkid\":4326}}";
		Geometry g = reader.read(polygon);

		//pass
//		String multipolygon = "{\"rings\":[[[-97.11502075195312,32.7783266418036],[-97.12120056152345,32.76764572990649],[-97.10197448730469,32.76389267278154],[-97.09270477294922,32.76966654128219],[-97.10472106933594,32.77688335023984],[-97.11502075195312,32.7783266418036]],[[-97.11227416992188,32.77313068261677],[-97.11570739746094,32.76793442005467],[-97.1026611328125,32.76620226512162],[-97.09785461425781,32.76764572990649],[-97.11227416992188,32.77313068261677]],[[-97.14111328124999,32.78207909030684],[-97.12051391601561,32.78005856077817],[-97.12635040283203,32.770821270041424],[-97.13939666748045,32.773708026397244],[-97.14111328124999,32.78207909030684]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(multipolygon);
		
		//pass -> single polygon
//		String polygon = "{\"rings\":[[[-97.13141441345215,32.77385236175715],[-97.12450504302979,32.77569261707643],[-97.11291790008544,32.7747905358906],[-97.11502075195312,32.76916134273928],[-97.13141441345215,32.77385236175715]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(polygon);
	
		//pass
//		String polygonWithHoles = "{\"rings\":[[[-97.13141441345215,32.77385236175715],[-97.12450504302979,32.77569261707643],[-97.11291790008544,32.7747905358906],[-97.11502075195312,32.76916134273928],[-97.13141441345215,32.77385236175715]],[[-97.12358236312866,32.77457403504532],[-97.12469816207887,32.773509564895136],[-97.1170163154602,32.77228270214884],[-97.11450576782227,32.7731487246666],[-97.12358236312866,32.77457403504532]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(polygonWithHoles);
		
		//pass
//		String multipolygonWithHolesAndOtherPoly = "{\"rings\":[[[-97.13141441345215,32.77385236175715],[-97.12450504302979,32.77569261707643],[-97.11291790008544,32.7747905358906],[-97.11502075195312,32.76916134273928],[-97.13141441345215,32.77385236175715]],[[-97.12358236312866,32.77457403504532],[-97.12469816207887,32.773509564895136],[-97.1170163154602,32.77228270214884],[-97.11450576782227,32.7731487246666],[-97.12358236312866,32.77457403504532]],[[-97.11066484451294,32.77343739696647],[-97.10875511169435,32.774213199132774],[-97.10819721221924,32.77201206838387],[-97.10909843444824,32.76964849852645],[-97.10989236831665,32.770460418913416],[-97.11066484451294,32.77343739696647]]],\"spatialReference\":{\"wkid\":4326}}";
//		Geometry g = reader.read(multipolygonWithHolesAndOtherPoly);

		System.out.println(g);
    }
    
    
    private static void testEsriWriter() {
		//Pass
//		String multipoint = "MULTIPOINT((-104.23828124999999 36.03133177633187),(-97.9541015625 37.125286284966805),(-99.71191406249999 33.87041555094183))";
//		Geometry g = toGeometry(multipoint);
		
		//pass
//		String point = "POINT(-103.56811523437501 35.37113502280101)";
//		Geometry g = toGeometry(point);

		//pass
//		String lineString = "LINESTRING(-105.44677734374999 34.57895241036947,-104.754638671875 34.79576153473033,-104.45800781250001 34.57895241036947)";
//		Geometry g = toGeometry(lineString);
		
		//pass
//		String multilineString = "MULTILINESTRING((-105.44677734374999 34.57895241036947,-104.754638671875 34.79576153473033,-104.45800781250001 34.57895241036947),(-103.809814453125 34.79576153473033,-103.34838867187499 34.97600151317589,-103.392333984375 34.68742794931485))";
//		Geometry g = toGeometry(multilineString);

		//pass
//		String polygon = "POLYGON((-102.79907226562501 35.3352932030933,-102.35961914062501 35.46961797120201,-102.425537109375 34.966998906703665,-102.76611328125 34.89494244739733,-102.79907226562501 35.3352932030933))";
//		Geometry g = toGeometry(polygon);
		
		//pass
//		String polyNonHole = "POLYGON((-97.06138 32.837 , -97.06133 32.836 , -97.06124 32.834 , -97.06127 32.832 , -97.06138 32.837), (-97.06326 32.759, -97.06298 32.755, -97.06153 32.749, -97.06326 32.759))";
//		Geometry g = toGeometry(polyNonHole);
		
		//pass
//		String polyHole = "POLYGON((-102.79907226562501 35.3352932030933,-102.35961914062501 35.46961797120201,-102.42553710937499 34.966998906703665,-102.76611328125 34.89494244739733,-102.79907226562501 35.3352932030933),(-102.62329101562499 35.191766965947394,-102.557373046875 35.074964853989556,-102.54638671875 35.23664622093196,-102.62329101562499 35.191766965947394))";
//		Geometry g = toGeometry(polyHole);

		//pass
//		String multipolygon = "MULTIPOLYGON(((-103.20693969726562 35.08620310578526,-103.13278198242189 35.112045209072974,-103.13278198242189 35.05360791102561,-103.17535400390626 34.996253759790164,-103.20693969726562 35.08620310578526)),((-103.09432983398438 35.11990857099681,-103.09570312500001 35.00187849469238,-102.98583984375001 35.015376280906935,-103.02291870117189 35.10755151867906,-103.09432983398438 35.11990857099681)))";
//		Geometry g = toGeometry(multipolygon);
		
		//failed, becoz not supported
		String geomCollection = "GEOMETRYCOLLECTION(MULTIPOLYGON(((-103.20693969726562 35.08620310578526,-103.13278198242189 35.112045209072974,-103.13278198242189 35.05360791102561,-103.17535400390626 34.996253759790164,-103.20693969726562 35.08620310578526)),((-103.09432983398438 35.11990857099681,-103.09570312500001 35.00187849469238,-102.98583984375001 35.015376280906935,-103.02291870117189 35.10755151867906,-103.09432983398438 35.11990857099681))),POINT(-103.12419891357419 35.01875037943829),LINESTRING(-103.12591552734372 35.07440290076302,-103.1193923950195 35.08536029060161,-103.11870574951169 35.07159307658134,-103.12557220458982 35.06765916019492,-103.11801910400388 35.05360791102558))";
		Geometry g = toGeometry(geomCollection);
		
		g.setSRID(4326);
		EsriJsonWriter writer = new EsriJsonWriter();
//		writer.setEncodeSR(false);
		String json = writer.write(g);
		System.out.println(json);
    }
    
    private static WKTReader wktReader = new WKTReader();
    public static Geometry toGeometry(String WKT){
	    if(WKT == null || WKT.isEmpty()) return null;
	    
	    Geometry geometry = null;
		try {
			geometry = wktReader.read(WKT);
		} catch (ParseException e) {
			e.printStackTrace();
		}
	    return geometry;
	}
}
